<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Persistance ParamÃ¨tres</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #1a1a1a; color: white; }
        .test-section { margin: 20px 0; padding: 15px; background: #2a2a2a; border-radius: 8px; }
        button { padding: 8px 15px; margin: 5px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #2563eb; }
        input { padding: 8px; margin: 5px; border-radius: 4px; border: 1px solid #ccc; }
        .current { font-weight: bold; color: #10b981; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Test Persistance ParamÃ¨tres Utilisateur</h1>

    <div class="test-section">
        <h3>ParamÃ¨tres Actuels</h3>
        <div id="current-params" class="current">Chargement...</div>
    </div>

    <div class="test-section">
        <h3>Modifier Bankroll</h3>
        <input type="number" id="bankroll-input" min="100" max="10000" step="50" placeholder="Bankroll (â‚¬)">
        <button onclick="updateBankroll()">Mettre Ã  jour</button>
    </div>

    <div class="test-section">
        <h3>Modifier Profil</h3>
        <button onclick="updateProfil('PRUDENT')">ğŸ›¡ï¸ Prudent</button>
        <button onclick="updateProfil('STANDARD')">âš–ï¸ Standard</button>
        <button onclick="updateProfil('AGRESSIF')">ğŸš€ Agressif</button>
    </div>

    <div class="test-section">
        <h3>Tests</h3>
        <button onclick="loadFromStorage()">ğŸ”„ Recharger depuis localStorage</button>
        <button onclick="clearStorage()">ğŸ—‘ï¸ Vider localStorage</button>
        <button onclick="testAPICall()">ğŸ“¡ Tester API avec paramÃ¨tres</button>
    </div>

    <div class="test-section">
        <h3>RÃ©sultats API</h3>
        <pre id="api-results"></pre>
    </div>

    <script>
        // Fonction pour charger les paramÃ¨tres
        function loadParams() {
            const bankroll = localStorage.getItem('user_bankroll') || '500';
            const profil = localStorage.getItem('user_profil') || 'STANDARD';

            document.getElementById('current-params').innerHTML = `
                ğŸ’° Bankroll: ${bankroll}â‚¬<br>
                ğŸ¯ Profil: ${profil}
            `;
            document.getElementById('bankroll-input').value = bankroll;
        }

        // Mettre Ã  jour la bankroll
        function updateBankroll() {
            const newBankroll = document.getElementById('bankroll-input').value;
            localStorage.setItem('user_bankroll', newBankroll);

            // DÃ©clencher l'Ã©vÃ©nement pour notifier les autres pages
            window.dispatchEvent(new CustomEvent('userSettingsChanged', {
                detail: {
                    bankroll: parseInt(newBankroll),
                    profil: localStorage.getItem('user_profil')
                }
            }));

            loadParams();
        }

        // Mettre Ã  jour le profil
        function updateProfil(newProfil) {
            localStorage.setItem('user_profil', newProfil);

            // DÃ©clencher l'Ã©vÃ©nement
            window.dispatchEvent(new CustomEvent('userSettingsChanged', {
                detail: {
                    bankroll: parseInt(localStorage.getItem('user_bankroll')),
                    profil: newProfil
                }
            }));

            loadParams();
        }

        // Recharger depuis storage
        function loadFromStorage() {
            loadParams();
        }

        // Vider le storage
        function clearStorage() {
            localStorage.removeItem('user_bankroll');
            localStorage.removeItem('user_profil');
            loadParams();
        }

        // Tester l'API
        async function testAPICall() {
            const bankroll = localStorage.getItem('user_bankroll') || '500';
            const profil = localStorage.getItem('user_profil') || 'STANDARD';

            const url = `http://localhost:8000/api/paris/recommandations-jour?bankroll=${bankroll}&profil=${profil}`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                document.getElementById('api-results').innerHTML = JSON.stringify({
                    profil_utilisateur: data.profil_utilisateur,
                    nb_courses: data.nb_courses,
                    resume: data.resume
                }, null, 2);
            } catch (error) {
                document.getElementById('api-results').innerHTML = `Erreur: ${error.message}`;
            }
        }

        // Charger au dÃ©marrage
        loadParams();

        // Ã‰couter les changements
        window.addEventListener('userSettingsChanged', () => {
            console.log('ParamÃ¨tres utilisateur modifiÃ©s!');
            loadParams();
        });
    </script>
</body>
</html>
