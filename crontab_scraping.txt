# ============================================================================
# CRONTAB - SCRAPING ET PIPELINE AUTOMATIQUE QUOTIDIEN
# ============================================================================
#
# Ce fichier contient la configuration cron pour automatiser le scraping
# quotidien des courses PMU avec toutes les donn√©es associ√©es.
#
# Installation:
#   crontab -e
#   # Copier les lignes ci-dessous dans l'√©diteur
#
# V√©rification:
#   crontab -l
#
# Logs:
#   tail -f logs/scraping_latest.log
#   ls -la logs/scraping_*.log
#
# ============================================================================

# Variables environnement
SHELL=/bin/zsh
PATH=/usr/local/bin:/usr/bin:/bin:/opt/homebrew/bin
PROJECT_DIR=/Users/gicquelsacha/horse3

# ============================================================================
# SCRAPING QUOTIDIEN - COURSES DU JOUR
# ============================================================================

# üåÖ Scraping matinal √† 6h00
# R√©cup√®re les courses programm√©es pour la journ√©e
# Donn√©es: chevaux, jockeys, entraineurs, cotes initiales
0 6 * * * /Users/gicquelsacha/horse3/cron_scraping_quotidien.sh >> /Users/gicquelsacha/horse3/logs/cron_scraping.log 2>&1

# ‚òÄÔ∏è Mise √† jour mi-journ√©e √† 12h00 (OPTIONNEL)
# Met √† jour les cotes qui ont √©volu√©
# Utile pour avoir les derni√®res cotes avant les courses de l'apr√®s-midi
# 0 12 * * * /Users/gicquelsacha/horse3/cron_scraping_quotidien.sh >> /Users/gicquelsacha/horse3/logs/cron_scraping.log 2>&1

# üåÜ Mise √† jour soir√©e √† 18h00 (OPTIONNEL)
# R√©cup√®re les r√©sultats des courses termin√©es
# 0 18 * * * /Users/gicquelsacha/horse3/cron_scraping_quotidien.sh >> /Users/gicquelsacha/horse3/logs/cron_scraping.log 2>&1

# üåô Enrichissement nocturne √† 23h30
# Enrichit avec cotes Turf.bzh et donn√©es Zone-Turf
30 23 * * * /Users/gicquelsacha/horse3/cron_enrichissement_quotidien.sh >> /Users/gicquelsacha/horse3/logs/cron_quotidien.log 2>&1

# ============================================================================
# RETRAINING HEBDOMADAIRE (OPTIONNEL)
# ============================================================================

# Chaque lundi √† 3h du matin - Retraining ML
# 0 3 * * 1 cd /Users/gicquelsacha/horse3 && source .venv/bin/activate && python train_online.py --days 7 --min-roc-auc 0.70 >> logs/cron_retraining.log 2>&1

# ============================================================================
# NETTOYAGE HEBDOMADAIRE
# ============================================================================

# Dimanche √† 4h du matin - Nettoyage des vieux logs
0 4 * * 0 find /Users/gicquelsacha/horse3/logs -name "*.log" -mtime +30 -delete 2>/dev/null

# ============================================================================
# NOTES IMPORTANTES
# ============================================================================
#
# Pour activer une ligne comment√©e, supprimez le # au d√©but
#
# V√©rifier que PostgreSQL tourne :
#   pg_isready -h localhost -p 54624
#
# Tester le script manuellement :
#   /Users/gicquelsacha/horse3/cron_scraping_quotidien.sh
#
# Voir les derniers logs :
#   tail -100 /Users/gicquelsacha/horse3/logs/scraping_latest.log
#
# En cas de probl√®me :
#   - V√©rifier les permissions : chmod +x cron_scraping_quotidien.sh
#   - V√©rifier PostgreSQL : brew services list
#   - V√©rifier le virtualenv : ls -la .venv/bin/python
#
# ============================================================================
