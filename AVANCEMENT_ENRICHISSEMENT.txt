# üéØ AVANCEMENT PLAN D'ENRICHISSEMENT COMPLET

**Date:** 3 novembre 2025
**Statut:** ‚úÖ Phase 1 en cours (SCRAPER 1 op√©rationnel)

---

## ‚úÖ TERMIN√â

### 1. Sch√©ma SQL enrichi complet (`schema_enrichi_complet.sql`)
- ‚úÖ 177 colonnes dans `cheval_courses_seen`
- ‚úÖ 72 colonnes dans `chevaux`
- ‚úÖ 4 vues analytiques cr√©√©es
- ‚úÖ 3 fonctions utilitaires (z-score, r√©duction km, vitesse)
- ‚úÖ Index optimis√©s pour recherches rapides

### 2. Architecture scrapers modulaires
- ‚úÖ Package `scrapers/` cr√©√©
- ‚úÖ Classe m√®re `BaseScraper` avec utilitaires communs
  - Connexion DB thread-safe
  - Requ√™tes HTTP avec fallback automatique
  - Normalisation texte/dates
  - Rate limiting
  - Context manager

### 3. SCRAPER 1 - M√©tadonn√©es course (`scrapers/metadata_course.py`)
- ‚úÖ **OP√âRATIONNEL** et test√© sur 2025-11-02
- ‚úÖ Enrichit 13 champs:
  - `course_id`, `meeting_id` (identifiants normalis√©s)
  - `heure_locale` (horaire d√©part)
  - `type_course` (Quint√©+, Prix de...)
  - `classe_course` (extraction intelligente)
  - `profil_piste`, `corde`
  - `meteo_code`, `vent_kmh`, `temperature_c`
  - `autostart_ligne`, `autostart_num`, `draw_stalle`, `rend_m`

**R√©sultats test (2025-11-02):**
- 12 r√©unions trait√©es
- 84 courses enrichies
- **1052 participants mis √† jour**
- 0 erreurs (apr√®s correction trigger)

---

## üöÄ EN COURS

### SCRAPER 2 - Cheval d√©tails
**Fichier:** `scrapers/cheval_details.py`
**Objectif:** Enrichir handicap, mat√©riel, ferrure, ELO

**Champs √† r√©cup√©rer (10):**
- `handicap_valeur`, `poids_porte_kg`, `decharge_kg`
- `ferrure`, `materiel`, `oeilleres`
- `rating_officiel`, `elo_avant_course`
- `days_off`, `statut_sante`

---

## üìã √Ä FAIRE

### SCRAPER 3 - Statistiques performances
**Fichier:** `scrapers/perf_stats.py`
**Calculs internes (13 champs):**
- Indices de forme, RK, SF, records, consistance

### SCRAPER 4 - Conditions jour
**Fichier:** `scrapers/conditions_jour.py`
**Analyse bias (8 champs):**
- Gate score, pace map, topographie

### SCRAPER 5 - Cotes march√©
**Fichier:** `scrapers/cotes_marche.py`
**√âvolution cotes (5 champs):**
- Ouverture, live, finale, delta, overround

### SCRAPER 6 - Sectionnels
**Fichier:** `scrapers/sectionnels.py`
**Chronos d√©taill√©s (15 champs):**
- 5 sectionnels, vitesses, speed figures

### SCRAPER 7 - Features ML
**Fichier:** `scrapers/features_ml.py`
**Mod√®le pr√©dictif (20 champs):**
- Indices, probas, edge, kelly

### SCRAPER 8 - Connections
**Fichier:** `scrapers/connections.py`
**Stats pros (5 champs):**
- Winrates, synergies, exp√©rience

---

## üìä COUVERTURE ACTUELLE

| Cat√©gorie | Total | Fait | % |
|-----------|-------|------|---|
| **Identifiants & contexte** | 22 | 13 | **59%** ‚úÖ |
| **Cheval** | 17 | 0 | 0% |
| **Connections** | 11 | 0 | 0% |
| **Historique perf** | 13 | 0 | 0% |
| **Conditions jour** | 9 | 0 | 0% |
| **March√© paris** | 5 | 0 | 0% |
| **Features calcul√©es** | 20 | 0 | 0% |
| **Sectionnels & chronos** | 16 | 0 | 0% |
| **Discipline Trot** | 5 | 0 | 0% |
| **Plat/Obstacle** | 6 | 0 | 0% |
| **R√©sultats** | 11 | 0 | 0% |
| **Qualit√©** | 4 | 0 | 0% |
| **TOTAL** | **139** | **13** | **9%** |

---

## üéØ PROCHAINES √âTAPES

### Imm√©diat (aujourd'hui)
1. ‚úÖ ~~SCRAPER 1 test√© et valid√©~~
2. üî® **Cr√©er SCRAPER 2** (cheval d√©tails)
3. üî® **Tester SCRAPER 2** sur 2025-11-02

### Cette semaine
4. Cr√©er SCRAPER 3 (stats perf)
5. Cr√©er SCRAPER 8 (connections)
6. Tester scrapers 3+8

### Semaine prochaine
7. Cr√©er SCRAPERS 4, 5, 6, 7
8. Cr√©er orchestrateur global
9. Pipeline automatis√©

---

## üíª COMMANDES UTILES

```bash
# Tester SCRAPER 1
python -m scrapers.metadata_course 2025-11-02

# V√©rifier enrichissement
docker exec -i pmuBDD psql -U postgres -d pmubdd -c "
SELECT COUNT(*) as total,
       COUNT(course_id) as avec_course_id,
       COUNT(type_course) as avec_type_course
FROM cheval_courses_seen
WHERE race_key LIKE '2025-11-02|%';
"

# Voir les colonnes disponibles
docker exec -i pmuBDD psql -U postgres -d pmubdd -c "\d cheval_courses_seen"
```

---

## üèÜ OBJECTIF FINAL

**100%** des 139 champs du dictionnaire PMU r√©cup√©r√©s
‚Üí Base de donn√©es compl√®te pour ML/pr√©dictions
‚Üí Value betting rentable !

**Estimation:** 3-4 semaines pour tout compl√©ter
